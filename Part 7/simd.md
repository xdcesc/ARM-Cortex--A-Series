## SIMD


SIMD 是一种计算技术，用于使用一条指令处理大量数据值(通常为2的幂)，操作数的数据被打包到特殊的宽寄存器中。因此，一条指令可以完成许多单独指令的工作。这种并行处理指令通常被称为 SIMD(单指令、多数据)，是 Michael J. Flynn 在 1966 年根据体系结构中可用指令和数据流的数量定义的四种计算机体系结构之一。

**Single Instruction Multiple Data (SIMD)**

一种使用一条指令处理多个数据值的技术，操作数的数据被封装在宽寄存器中。因此，一条指令可以做许多的工作。SIMD 指令对于媒体数据的计算非常强大。

**Single Instruction, Single Data (SISD)**

单个核心执行单个指令流，操作存储在单个内存中的数据，每次一个操作。通常有一个中央控制器将指令流广播给所有的处理元素。在 ARMv6 体系结构之前，几乎所有的 ARM 处理器都使用 SISD 处理。

**Multiple Instruction, Single Data (MISD)**

一种并行计算体系结构，其中许多功能单元对相同的数据执行不同的操作。为了检测和屏蔽错误而执行相同指令的容错计算机可能被认为属于这种类型。其中一个例子就是航天飞机飞行控制计算。

**Multiple Instruction, Multiple Data (MIMD)**
多个计算机指令，可能是相同的，也可能是彼此同步的，同时对两个或多个数据片段执行操作。多核超标量处理器是一种 MIMD 处理器。

对于可以并行化的代码，可以实现较大的性能改进。许多 32 位体系结构上都有 SIMD 扩展——PowerPC 有 AltiVec, x86 有多种 MMX/SSE 变体。SIMD 在第五章中详解。

许多软件程序在大型数据集上运行。数据项的大小可以小于 32 位。8 位像素数据在视频、图形和图像处理中很常见，16 位样本在音频编解码器中很常见。在这种情况下，要执行的操作很简单，重复很多次，对控制代码的需求很少。SIMD 可以为这种类型的数据处理提供相当大的性能改进。它特别有利于数字信号处理或多媒体算法，如:

* Block-based data processing.
* Audio, video, and image processing codecs.
* 2D graphics based on rectangular blocks of pixels
* 3D graphics
* Color-space conversion.
* Physics simulations

在 32 位内核(如 Cortex-A 系列处理器)上，一次执行大量 8 位或 16 位的单个操作相对低效。处理器 ALU、寄存器和 datapath 是为 32 位计算而设计的。SIMD 允许一条指令将寄存器值视为多个数据元素(例如，32 位寄存器中的 4 个 8 位值)，并对这些元素执行多个相同的操作。

![](/assets/figure7-1.png)

要在不使用 SIMD 的情况下实现四个独立的添加，需要使用四个 ADD 指令，如 Figure 7-1 所示，以及其他指令，以防止一个结果溢出到相邻的字节。SIMD 只需要一条指令就可以做到这一点。

![](/assets/figure7-2.png)

Figure 7-2 演示了 SIMD uadd8r0, R1, R2 指令的操作。该操作将 4 对 8 位元素(称为“行”)并行添加到存储在通用寄存器 R1 和 R2 中的向量中，并将结果放入寄存器 R0 中的向量中。

重要的是要注意加法操作是真正独立的。0 通道 [7] 位的任何溢出或进位不会影响 1 通道 [0] 位(整个寄存器的 [8] 位)，这是一个单独的计算。

ARM NEON 技术是基于 SIMD 的概念而设计的。NEON 是一个 64 位和 128 位 SIMD 指令集，提供了 128 位宽的矢量操作，与 ARMv6 架构中的 32 位SIMD相比。ARMv7 体系结构中引入的 NEON 技术目前仅适用于 ARM Cortex-A 和 Cortex-R 系列处理器。它是一种面向高级媒体和信号处理应用程序和嵌入式处理器的 SIMD 技术，可以加速多媒体和信号处理算法，如视频编码/解码，2D/3D图形，游戏，音频和语音处理，图像处理，电话和声音合成至少两倍于 ARMv6 SIMD 的性能。

NEON 默认包含在 Cortex-A7、Cortex-A12 和 Cortex-A15 处理器中，但在所有其他 ARMv7 Cortex-A 系列处理器中是可选的。NEON 可以在运行于 10MHZ 的处理器上执行 MP3 音频解码。它具有完整的指令集、独立的寄存器文件和独立的执行硬件。NEON 支持 8 位、16 位、32 位和 64 位的整数和单精度(32位)浮点数据和 SIMD 操作来处理音频和视频处理以及图形和游戏处理。NEON 支持多达 16 次的操作。NEON 硬件共享了与 VFP 相同的寄存器。它作为 ARM 处理器的一部分实现，但是有自己的执行管道和一个与 ARM core 寄存器库不同的寄存器库。NEON 数据被组织进很长的寄存器(64 位或 128 位宽)。这些寄存器可以保存 8、16、32 或 64 位长的数据项。

