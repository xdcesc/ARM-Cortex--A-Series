## ARM 指令集

ARMv7 架构是一个 32 位处理器架构。它也是一种加载/存储体系结构，这意味着数据处理指令仅在通用寄存器中的值上操作。只有加载和存储指令才能访问内存。通用寄存器也是32位。在这本书中，当我们提到一个 word 时，我们指的是32位。因此，doubleword 是64位，halfword 是16位。

虽然 ARMv7 架构是一个 32 位架构，但是单个处理器实现不一定对所有块和互连都有32位宽度。例如，可以使用 64 位或更宽的路径进行指令获取或数据访问。

大多数 ARM 处理器支持两个甚至三个不同的指令集，而有些\(例如 Cortex-M3 处理器\)实际上并不执行原始的 ARM 指令集。以下是 ARM 处理器至少可以使用的两个指令集。

**ARM \(32-bit instructions\)**

这是原始的ARM指令集。

**Thumb**

Thumb 指令集最初是在 ARM7TDMI 处理器中添加的，它只包含16位指令，这就以牺牲某些性能为代价，提供了更小的程序\(在较小的嵌入式系统中，内存占用可能是一个主要问题\)。最近的处理器，包括 Cortex-A 系列的处理器，支持 Thumb-2 技术，它扩展了 Thumb 指令集，提供了 16 位指令和 32 位指令的组合。这提供了两方面的优点，性能类似于 ARM 指令集，代码大小类似于 Thumb指令。由于其大小和性能优势，使用 Thumb-2 技术编译或组装所有代码变得越来越普遍。

在旧的 ARM 处理器中，系统通常包含为 ARM 状态编译的代码和为 Thumb 状态编译的代码。ARM 代码使用 32 位指令，功能更强大，执行特定任务所需的指令更少，因此可能更适合系统中性能关键部分。它也用于异常处理程序代码，因为异常不能在 ARM7 或ARM9 系列处理器上以 Thumb 状态处理。

Thumb 代码，使用 16 位指令，与 ARM 指令相比需要更多的指令来做相同的任务。Thumb 代码能对一些更小的常数使用指令编码并且有更短的相对分支。具体见第五章的 Branches。可用的相对分支范围约为 ARM 指令的 ±32 MB 和 Thumb-2 扩展的 ±16 MB。Thumb 进一步限制在于只有 16 位指令，导致条件分支在 ±256 字节以内和无条件的相对分支被限制在 ±2048 字节以下。

然而，由于 Thumb 指令的大小只有 ARM 代码的一半，所以程序通常比 ARM 代码小三分之一。因此，出于代码密度和减少系统内存需求的原因，使用 Thumb 指令。当处理器直接连接到一个狭窄\(16位\)内存时（没有缓存的好处），Thumb 代码也能胜过 ARM。每个循环可以获取一条 Thumb 指令，而每个 32 位 ARM 指令每次获取需要两个时钟周期。



