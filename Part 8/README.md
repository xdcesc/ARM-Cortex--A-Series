# 第八章：缓存

cache 一词来源于法语动词 cacher:to hide。这个词在处理器上的应用是显而易见的——缓存是处理器存储指令和数据的地方，对程序员和系统来说是隐藏的。在很多情况下，缓存对您是透明的，或者对您是隐藏的。但是，正如我们将看到的，经常需要详细了解缓存的操作。

当 ARM 架构首次开发时，处理器的时钟速度和内存的访问速度大致相似。今天的处理器内核要复杂得多，可以更快地计时数量级。然而，外部总线和内存设备的频率并没有达到相同的比例。实现芯片上的小块 SRAM 是可以以与核心相同的速度运度的，但这种 RAM 与标准 DRAM 块相比非常昂贵，后者的容量可能是核心块的数千倍。在许多基于 ARM 处理器的系统中，对外部内存的访问需要几十甚至几百个核心周期。

![](/assets/figure8-1.png)

从本质上讲，缓存是位于核心内存和主内存之间的一小块快速内存。它在主内存中保存项目的副本。访问缓存内存要比访问主内存快得多。因为缓存只包含主内存内容的一个子集，所以它必须同时将项的地址和相关数据存储在主内存中。每当核心要读取或写入特定地址时，它首先会在缓存中查找。如果它在缓存中找到了地址，它将使用缓存中的数据，而不必对主内存进行访问。这大大提高了系统的潜在性能，减少了外部内存访问时间缓慢的影响。它还避免了驱动外部信号的需要，从而降低了系统的功耗。

与系统中使用的总体内存相比，缓存大小比较小。更大的缓存可以产生更昂贵的芯片。此外，增大内核缓存可能会限制内核的最大速度。高效利用有限的资源是编写在核心上运行的高效应用程序的关键部分。

芯片上的 SRAM 可用于实现缓存，缓存保存来自主存储器的指令和数据的临时副本。代码和数据具有时间和空间局部性。这意味着随着时间的推移，程序倾向于重用相同的地址(时间局域)，并且倾向于使用彼此接近的地址(空间局域)。例如，代码可以包含循环，这意味着重复执行相同的代码或多次调用函数。数据访问(例如对堆栈的访问)可以限制在内存的小区域内。正是由于内核对 RAM 的访问具有这种局部性，而不是真正的随机访问，才使得缓存能够成功。

写缓冲区是一个块，当从外部内存总线执行存储指令时，它将核心执行的写分离开。核心将与存储相关联的地址、控件和数据值放在一组硬件缓冲区中。和缓存一样，它位于核心和主内存之间。这使得核心可以继续运行并执行下一个指令，而无需停止并等待缓慢的主内存实际完成写入操作。


