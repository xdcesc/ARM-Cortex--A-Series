## 缓存的缺点

缓存和写缓冲区似乎是自动的优点，因为它们加速了程序的执行。然而，它们也增加了一些在非开放内核中不存在的问题。这样的缺点之一是程序执行时间可能变得不确定。

这意味着，由于缓存很小，并且只包含主内存的一个子集，所以当程序执行时，它会迅速填充。当缓存已满时，必须删除现有的代码或数据，以便为新项腾出空间。因此，在任何给定的时间，应用程序通常不可能确定是否在缓存中找到特定的指令或数据项。

这意味着某段代码的执行时间可能会发生很大的变化。在硬实时系统中，这可能是一个需要强烈确定性行为的问题。

此外，您还需要一种方法来控制缓存和写缓冲区如何访问内存的不同部分。在某些情况下，您希望内核从外部设备(如外设)读取最新数据。例如，使用计时器外围设备的缓存值是不明智的。有时候，您希望内核停止并等待存储完成。所以缓存和写缓冲区给你一些额外的工作要做。

有时候缓存和外部内存的内容可能不一样，这是因为处理器可以更新缓存内容，而这些内容还没有写回主内存。或者，一个代理可以在一个核心拥有自己的副本之后更新主内存。这是一个连贯的问题。当您有多个内核或内存代理(如外部 DMA 控制器)时，这可能是一个特殊的问题。连贯性问题将在本书后面进行描述。